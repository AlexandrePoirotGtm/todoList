<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Acceuil</title>
	<link rel="stylesheet"
		  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
		  crossorigin="anonymous" />
</head>
<body>
	<div class="container">
		<h1>Bienvenue</h1>
		<div id="listeTaches">

		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
			integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
			crossorigin="anonymous"></script>
	<script>
		function getTaches() {
			$.ajax({
				url: '/api/taches',
				success: function (taches) {
					var divListeTaches = $('#listeTaches');
					for (tache of taches) {
						var divTache = $('<div class="Tache alert"></div>');
						divTache.attr("data-id", tache.ID);
						var inputEtat = $('<input type="checkbox">');
						inputEtat.attr('checked', tache.Statut);
						if (tache.Statut) {
							divTache.addClass('alert-success');
						}
						// Appeler le serveur quand on clique dessus
						inputEtat.on('click', function () {
							var div = $(this).closest(".Tache");
							var idTache = div.attr("data-id");
							ModifierStatutTache(idTache, this);
						});
						divTache.append(inputEtat);
						divTache.append($('<label></label>').text(tache.Nom));
						divListeTaches.append(divTache);
					}
				},
				error: Erreur
			});
		}
		function Erreur() {
			alert("Erreur !");
		}
		function ModifierStatutTache(id, input) {
			$.ajax({
				type: 'PUT',
				url: '/api/tachestatut/' + id + '?statut=' + input.checked,
				success: function () {
					var divTache = $(input).closest(".Tache");
					if (input.checked) {
						divTache.addClass('alert-success');
					} else {
						divTache.removeClass('alert-success');
					}
				},
				error: Erreur
			});
		}
		getTaches();
	</script>
</body>
</html>